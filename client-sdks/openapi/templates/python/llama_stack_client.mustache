# coding: utf-8

{{>partial_header}}

import httpx
import json
from typing import Optional, Any, Mapping
from ._version import __version__

from {{packageName}}.api_client import ApiClient
from {{packageName}}.async_api_client import AsyncApiClient
from {{packageName}}.configuration import Configuration
{{#apiInfo}}{{#apis}}from {{apiPackage}}.{{classFilename}} import {{classname}}
{{/apis}}{{/apiInfo}}


class LlamaStackClient:
    """
    LlamaStack unified client that provides access to all API endpoints.

    This client creates instances of all available API classes and provides
    them as attributes for easy access.

    Example:
        >>> from {{packageName}} import Configuration, LlamaStackClient
        >>>
        >>> config = Configuration(host="http://localhost:8000")
        >>> client = LlamaStackClient(config)
        >>>
        >>> # Access specific APIs through the client
        {{#apiInfo}}{{#apis}}{{#-first}}>>> client.{{baseName}}  # Access {{classname}}
        {{/-first}}{{/apis}}{{/apiInfo}}
    """

    def __init__(
        self,
        configuration: Optional[Configuration] = None,
        header_name: Optional[str] = None,
        header_value: Optional[str] = None,
        cookie: Optional[str] = None,
        default_headers : Mapping[str, str] | None = None,
        provider_data: Mapping[str, Any] | None = None,
        **kwargs,
    ) -> None:
        """
        Initialize the LlamaStackClient.

        Args:
            configuration: Configuration object or string URL. If string, creates Configuration with that host.
                          If None, uses default configuration.
            header_name: Optional header name for authentication.
            header_value: Optional header value for authentication.
            cookie: Optional cookie string for authentication.
        """
        # Handle string URL as configuration
        if isinstance(configuration, str):
            configuration = Configuration(host=configuration)
        elif configuration is None:
            if kwargs is not None and kwargs != {}:
                configuration = Configuration(**kwargs)
            else:
                configuration = Configuration.get_default_copy()

        self.configuration = configuration
        self.base_url = self.configuration.base_url

        # Create the API client
        self.api_client = ApiClient(
            configuration=configuration,
            header_name=header_name,
            header_value=header_value,
            cookie=cookie,
        )

        # Store reference to parent client for _prepare_request hook
        self.api_client._parent_client = self
        if hasattr(self.api_client, 'rest_client'):
            self.api_client.rest_client._parent_client = self
        elif hasattr(self.api_client, '_client'):
            self.api_client._client._parent_client = self

        # Compatibility with stainless
        custom_headers = default_headers or {}
        custom_headers["X-LlamaStack-Client-Version"] = __version__
        if provider_data is not None:
            custom_headers["X-LlamaStack-Provider-Data"] = json.dumps(provider_data)

        for header_k, header_v in custom_headers.items():
            self.api_client.set_default_header(header_k, header_v)

        # Initialize all API instances
{{#apiInfo}}{{#apis}}        self.{{baseName}} = {{classname}}(self.api_client)
{{/apis}}{{/apiInfo}}
        # Set up nested API structure based on x-nesting-config
{{#apiInfo}}{{#apis}}{{#operations}}{{#operation}}{{#vendorExtensions.x-nesting-config}}{{#.}}        self.{{parent}}.{{child}} = self.{{child}}
{{/.}}{{/vendorExtensions.x-nesting-config}}{{/operation}}{{/operations}}{{/apis}}{{/apiInfo}}
        # this is iich but we need it because chat.completions and completions are not the same thing
        self.chat.__dict__['completions'] = self.chat_completions
        # same issue with vector_stores.files and files - they got merged into different API classes
        self.vector_stores.__dict__['files'] = self.vector_stores_files

    def __enter__(self):
        """Context manager entry."""
        return self

    def __exit__(self, exc_type, exc_value, traceback):
        """Context manager exit."""
        self.close()

    def close(self):
        """Close the API client and release resources."""
        if hasattr(self, 'api_client'):
            self.api_client.close()

    def _prepare_request(self, request: httpx.Request) -> None:
        return None


class AsyncLlamaStackClient:
    """
    Async LlamaStack unified client that provides access to all API endpoints.

    This async client creates instances of all available API classes and provides
    them as attributes for easy access with async/await support.

    Example:
        >>> from {{packageName}} import Configuration, AsyncLlamaStackClient
        >>>
        >>> config = Configuration(host="http://localhost:8000")
        >>> async with AsyncLlamaStackClient(config) as client:
        >>>     # Access specific APIs through the client
        {{#apiInfo}}{{#apis}}{{#-first}}>>>     await client.{{baseName}}.some_method()  # Access {{classname}}
        {{/-first}}{{/apis}}{{/apiInfo}}
    """

    def __init__(
        self,
        configuration: Optional[Configuration] = None,
        header_name: Optional[str] = None,
        header_value: Optional[str] = None,
        cookie: Optional[str] = None,
        **kwargs,
    ) -> None:
        """
        Initialize the AsyncLlamaStackClient.

        Args:
            configuration: Configuration object or string URL. If string, creates Configuration with that host.
                          If None, uses default configuration.
            header_name: Optional header name for authentication.
            header_value: Optional header value for authentication.
            cookie: Optional cookie string for authentication.
        """
        # Handle string URL as configuration
        if isinstance(configuration, str):
            configuration = Configuration(host=configuration)
        elif configuration is None:
            if kwargs is not None and kwargs != {}:
                configuration = Configuration(**kwargs)
            else:
                configuration = Configuration.get_default_copy()

        self.configuration = configuration

        # Create the async API client
        self.api_client = AsyncApiClient(
            configuration=configuration,
            header_name=header_name,
            header_value=header_value,
            cookie=cookie,
        )

        # Store reference to parent client for _prepare_request hook
        self.api_client._parent_client = self
        if hasattr(self.api_client, 'rest_client'):
            self.api_client.rest_client._parent_client = self
        elif hasattr(self.api_client, '_client'):
            self.api_client._client._parent_client = self

        # Initialize all API instances
{{#apiInfo}}{{#apis}}        self.{{baseName}} = {{classname}}(self.api_client)
{{/apis}}{{/apiInfo}}
        # Set up nested API structure based on x-nesting-config
{{#apiInfo}}{{#apis}}{{#operations}}{{#operation}}{{#vendorExtensions.x-nesting-config}}{{#.}}        self.{{parent}}.{{child}} = self.{{child}}
{{/.}}{{/vendorExtensions.x-nesting-config}}{{/operation}}{{/operations}}{{/apis}}{{/apiInfo}}
        # this is iich but we need it because chat.completions and completions are not the same thing
        self.chat.__dict__['completions'] = self.chat_completions
        # same issue with vector_stores.files and files - they got merged into different API classes
        self.vector_stores.__dict__['files'] = self.vector_stores_files
    async def __aenter__(self):
        """Async context manager entry."""
        return self

    async def __aexit__(self, exc_type, exc_value, traceback):
        """Async context manager exit."""
        await self.close()

    async def close(self):
        """Close the async API client and release resources."""
        if hasattr(self, 'api_client'):
            await self.api_client.close()

    async def _prepare_request(self, request: httpx.Request) -> None:
        return None
